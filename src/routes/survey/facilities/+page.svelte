<script>
  export let data;
  export let form;

  let q1 = '';
  let q2 = '';
  let q3 = '';
  let q4 = '';
  let q5 = '';
  let q6 = '';
  let q7 = '';
  let q8 = '';

  let formEl;
  let submittedData = null;
  let showConfirm = false;
  let isSubmitting = false;

  const facilitiesRecords = data.facilitiesRecords;

  function handleSubmit(e) {
    if (!isSubmitting) {
      e.preventDefault();
      submittedData = { q1, q2, q3, q4, q5, q6, q7, q8 };
      showConfirm = true;
    }
  }

  function confirmSubmit() {
    showConfirm = false;
    isSubmitting = true;
    formEl.requestSubmit();
  }

  function closeModal() {
    showConfirm = false;
  }
</script>

<h1>üè† ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</h1>

<form bind:this={formEl} method="POST" action="?/submit" on:submit={handleSubmit}>
  <div class="card">
    <p>Q1: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÅ‡∏¢‡∏Å‡∏ä‡∏ô‡∏¥‡∏î ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô</p>
    <input type="text" name="q1" bind:value={q1} required />
  </div>

  <div class="card">
    <p>Q2: ‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏™‡∏ô‡∏¥‡∏ó/‡∏ï‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö</p>
    <label><input type="radio" name="q2" value="‡πÉ‡∏ä‡πà" bind:group={q2} required> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="q2" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà" bind:group={q2}> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <div class="card">
    <p>Q3: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ</p>
    <input type="text" name="q3" bind:value={q3} required />
  </div>

  <div class="card">
    <p>Q4: ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏/‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û‡∏ñ‡∏π‡∏Å‡πÅ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö/‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
    <label><input type="radio" name="q4" value="‡πÉ‡∏ä‡πà" bind:group={q4} required> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="q4" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà" bind:group={q4}> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <div class="card">
    <p>Q5: ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏ä‡∏ô‡∏∞/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ/‡∏õ‡∏∏‡πã‡∏¢ ‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏û‡∏≤‡∏´‡∏∞</p>
    <label><input type="radio" name="q5" value="‡πÉ‡∏ä‡πà" bind:group={q5} required> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="q5" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà" bind:group={q5}> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <div class="card">
    <p>Q6: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</p>
    <input type="text" name="q6" bind:value={q6} required />
  </div>

  <div class="card">
    <p>Q7: ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πã‡∏¢/‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏î‡∏¥‡∏ô/‡∏´‡∏°‡∏±‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</p>
    <input type="text" name="q7" bind:value={q7} required />
  </div>

  <div class="card">
    <p>Q8: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å/‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢/‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</p>
    <label><input type="radio" name="q8" value="‡πÉ‡∏ä‡πà" bind:group={q8} required> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="q8" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà" bind:group={q8}> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <div class="actions">
    <button type="submit">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>
</form>

<form method="POST" action="?/reset" style="margin-top:1rem;">
  <button type="submit" class="reset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
</form>

<!-- ‚úÖ Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á -->
{#if showConfirm && submittedData}
  <div class="modal-backdrop" on:click={closeModal}>
    <div class="modal" on:click|stopPropagation>
      <h3>üßæ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á</h3>
      <ul>
        {#each Object.entries(submittedData) as [key, value]}
          <li><strong>{key.toUpperCase()}:</strong> {value}</li>
        {/each}
      </ul>
      <div class="modal-actions">
        <button on:click={closeModal}>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="confirm" on:click={confirmSubmit}>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
      </div>
    </div>
  </div>
{/if}

<style>
  .card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 14px;
    margin-bottom: 12px;
  }

  .actions {
    margin-top: 12px;
  }

  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .modal {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 16px;
  }

  .confirm {
    background: #16a34a;
    color: #fff;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
  }

  .confirm:hover {
    opacity: 0.9;
  }

  .actions button {
    background: #16a34a;
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.2s;
  }

  .actions button:hover {
    opacity: 0.9;
  }

  form .reset {
    background: #ef4444;
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }

</style>
